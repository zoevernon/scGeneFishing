---
title: "GeneFishing"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{GeneFishing}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(GeneFishing)
data("pancreas")
data("insulin_secretion")

# log of count matrix
head(pancreas[, 1:4])

# GO term 
insulin_secretion[1:6]
```



## Probe for bait sets 
Search through ```insulin_secretion``` to find a subset of genes that can be used
as bait in GeneFishing. 
```{r probe_fishability}
set.seed(3908)
go_subset <- intersect(rownames(pancreas), insulin_secretion)
baits <- probeFishability(pancreas, go_subset, umap = FALSE, n_rounds = 50,
                          min_genes = 10)
baits
```

Will randomly sample genes and plot discovered bait with those randomly sampled
genes.  This shows two different random samples
```{r plot_probe_results1, fig.width=7, fig.height=4}
plot(baits)
```


```{r plot_probe_results2, fig.width=7, fig.height=4}
plot(baits)
```


## Do GeneFishing
Need to update this function to take directly in the ```baits``` object and 
where it will check if the supplied bait can actually be used before trying to 
do GeneFishing (as described in README).  Note, in practice one should do more than
100 rounds of GeneFishing, however to make the vignette compute in a reasonable
amount of time we are only using 100 here.  

```{r gene_fishing}
fishing_results <- geneFishing(pancreas,
                               baits$best_bait,
                               fishing_rounds = 50,
                               umap = FALSE)
fishing_results
```

Plot of capture frequency rate (CFR)
```{r plot_gene_fishing, fig.width=7, fig.height=4}
plot(fishing_results)
```

For a bait set with this tightness, one might consider using three clusters in GeneFishing
to get a more accurate set of fished out genes
```{r gf_three_clusters, fig.width=7, fig.height=4}
fishing_results_k3 <- geneFishing(pancreas,
                                  baits$best_bait,
                                  fishing_rounds = 50,
                                  k = 3,
                                  umap = FALSE)
fishing_results_k3
```


```{r plot_gf_three_clusters, fig.width=7, fig.height=4}
plot(fishing_results_k3)
```
